<!-- /templates/cosmetics/index.html -->
{% extends 'base.html' %}
{% block title %}Cosmetic Products{% endblock %}
{% block content %}

<h1>Cosmetic Products</h1>

<form method="get" class="mb-8">
    <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
        <div>
            <label for="id_category" class="block text-sm font-medium text-gray-700">Category</label>
            {{ form.category }}
        </div>
        
        <div>
            <label for="id_subcategory" class="block text-sm font-medium text-gray-700">Subcategory</label>
            {{ form.subcategory }}
        </div>
        
        <div>
            <label for="id_brand" class="block text-sm font-medium text-gray-700">Brand</label>
            {{ form.brand }}
        </div>
        
        <div>
            <label for="id_min_rating" class="block text-sm font-medium text-gray-700">Minimum Rating</label>
            {{ form.min_rating }}
        </div>
        
        <div>
            <label for="id_max_price" class="block text-sm font-medium text-gray-700">Maximum Price</label>
            {{ form.max_price }}
        </div>
        
        <div class="flex items-end">
            <button type="submit" class="px-4 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500">
                Find Products
            </button>
        </div>
    </div>
</form>

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    {% for product in products %}
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-6">
                <h2 class="text-xl font-semibold text-gray-800">{{ product.product_name }}</h2>
                <p class="text-sm text-gray-600 mt-1">{{ product.brand }}</p>
                <p class="text-lg font-bold text-pink-600 mt-2">₹{{ product.price }}</p>
                
                <div class="mt-2 flex flex-wrap gap-1">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-pink-100 text-pink-800">
                        {{ product.category }}
                    </span>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                        {{ product.subcategory }}
                    </span>
                </div>
                
                <div class="mt-3 flex items-center">
                    {% if product.rating %}
                        <span class="text-yellow-400">★</span>
                        <span class="ml-1 text-sm text-gray-700">{{ product.rating }}</span>
                    {% endif %}
                    <span class="ml-2 text-xs text-gray-500">({{ product.noofratings|default:"0" }} reviews)</span>
                </div>
                
                <a href="{% url 'cosmetics:detail' product.id %}" class="mt-4 inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-pink-700 bg-pink-100 hover:bg-pink-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500">
                    View Details →
                </a>
            </div>
        </div>
    {% empty %}
        <div class="col-span-full text-center py-8">
            <p class="text-gray-500">No products found matching your criteria.</p>
        </div>
    {% endfor %}
</div>

{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get references to the category and subcategory select elements
        const categorySelect = document.getElementById('id_category');
        const subcategorySelect = document.getElementById('id_subcategory');
        
        // Define subcategories for each category
        const subcategories = {
            '': [['', 'All Subcategories']],  // Default option for "All Categories"
            'eyes': [
                ['', 'All Eye Products'],
                ['eyeshadow', 'Eyeshadow'],
                ['mascara', 'Mascara'],
                ['eyeliner', 'Eyeliner'],
                ['eyebrow', 'Eyebrow Products'],
                ['eye_primer', 'Eye Primer']
            ],
            'face': [
                ['', 'All Face Products'],
                ['foundation', 'Foundation'],
                ['concealer', 'Concealer'],
                ['powder', 'Powder'],
                ['blush', 'Blush'],
                ['bronzer', 'Bronzer'],
                ['highlighter', 'Highlighter'],
                ['primer', 'Primer']
            ],
            'lips': [
                ['', 'All Lip Products'],
                ['lipstick', 'Lipstick'],
                ['lip_gloss', 'Lip Gloss'],
                ['lip_liner', 'Lip Liner'],
                ['lip_balm', 'Lip Balm']
            ],
            'body': [
                ['', 'All Body Products'],
                ['lotion', 'Lotion'],
                ['scrub', 'Scrub'],
                ['shower_gel', 'Shower Gel'],
                ['oil', 'Body Oil'],
                ['spray', 'Body Spray']
            ],
            'skincare': [
                ['', 'All Skincare Products'],
                ['cleanser', 'Cleanser'],
                ['moisturizer', 'Moisturizer'],
                ['serum', 'Serum'],
                ['mask', 'Face Mask'],
                ['toner', 'Toner'],
                ['eye_cream', 'Eye Cream'],
                ['sunscreen', 'Sunscreen']
            ],
            'hair': [
                ['', 'All Hair Products'],
                ['shampoo', 'Shampoo'],
                ['conditioner', 'Conditioner'],
                ['mask', 'Hair Mask'],
                ['oil', 'Hair Oil'],
                ['styling', 'Styling Products'],
                ['treatment', 'Treatment']
            ]
        };
        
        // Function to update subcategories based on selected category
        function updateSubcategories() {
            const selectedCategory = categorySelect.value;
            const availableSubcategories = subcategories[selectedCategory] || subcategories[''];
            
            // Clear existing options
            subcategorySelect.innerHTML = '';
            
            // Add new options
            availableSubcategories.forEach(function(subcategory) {
                const option = document.createElement('option');
                option.value = subcategory[0];
                option.textContent = subcategory[1];
                subcategorySelect.appendChild(option);
            });
        }
        
        // Update subcategories when the page loads
        updateSubcategories();
        
        // Update subcategories when the category changes
        categorySelect.addEventListener('change', updateSubcategories);
        
        // Preserve selected subcategory if it exists in the URL
        const urlParams = new URLSearchParams(window.location.search);
        const subcategoryParam = urlParams.get('subcategory');
        
        if (subcategoryParam) {
            // Find and select the option that matches the URL parameter
            for (let i = 0; i < subcategorySelect.options.length; i++) {
                if (subcategorySelect.options[i].value === subcategoryParam) {
                    subcategorySelect.selectedIndex = i;
                    break;
                }
            }
        }
    });
</script>
{% endblock %}